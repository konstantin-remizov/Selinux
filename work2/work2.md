## SELinux: проблема с удаленным обновлением зоны DNS

Инженер настроил следующую схему:  

- ns01 - DNS-сервер (192.168.50.10);  
- client - клиентская рабочая станция (192.168.50.15)  

При попытке удаленно внести изменения в зону ddns.lab происходит следующее:  

``[vagrant@client ~]$ nsupdate -k /etc/named.zonetransfer.key``  
`` \- server 192.168.50.10``  
`` \- zone ddns.lab``  
``\- update add www.ddns.lab. 60 A 192.168.50.15``  
``\- send``  
``update failed: SERVFAIL``  

## Задача  

- Выяснить причину неработоспособности механизма обновления зоны.
- Предложить решение (или решения) для данной проблемы.
- Выбрать одно из решений для реализации, предварительно обосновав выбор.
- Реализовать выбранное решение и продемонстрировать его работоспособность.


## Решение  

На клиентской машине (client) посмотрим логи SELinux, чтобы понять в чём может быть проблема.  
Для этого воспользуемся утилитой audit2why:  
``sudo -i``  
``cat /var/log/audit/audit.log | audit2why``  
  
Тут мы видим, что на клиенте отсутствуют ошибки.  
  
Не закрывая сессию на клиенте, подключимся к серверу ns01 и проверим логи SELinux здесь:  
``sudo -i``
``cat /var/log/audit/audit.log | audit2why``  
  
В логах увидим, что ошибка в контексте безопасности. Вместо типа named_t используется тип etc_t.  
Проверим данную проблему в каталоге /etc/named:  
ls -laZ /etc/named  
  
Тут мы также видим, что контекст безопасности неправильный. Проблема
заключается в том, что конфигурационные файлы лежат в другом каталоге.  
Посмотреть в каком каталоги должны лежать, файлы, чтобы на них
распространялись правильные политики SELinux можно с помощью команды:  
semanage fcontext -l | grep named  
  
Изменим тип контекста безопасности для каталога /etc/named:  
``chcon -R -t named_zone_t /etc/named``  
``ls -laZ /etc/named``  
  
Попробуем снова внести изменения с клиента (client):  
``[vagrant@client ~]$ nsupdate -k /etc/named.zonetransfer.key
> server 192.168.50.10
> zone ddns.lab
> update add www.ddns.lab. 60 A 192.168.50.15
> send
> quit``  
  
Проверим:  
``dig www.ddns.lab``  
  
Видим, что изменения применились.  
Попробуем перезагрузить хосты и ещё раз сделать запрос с помощью dig:  
``dig @192.168.50.10 www.ddns.lab``  
  
Всё правильно. После перезагрузки настройки сохранились.  
Для того, чтобы на машине ns01 вернуть правила обратно, можно ввести там команду:  
``restorecon -v -R /etc/named``  
